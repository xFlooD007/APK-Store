
@{
    ViewBag.Title = "Index";
    Layout = "~/rhapsodylatest/Views/Dashboard/DashboardLayout.cshtml";
    var num = (int)ViewBag.NumOfAllApks;
    var users = (IQueryable<rhapsodyLatest.Auth.AppUser>)ViewBag.AllUsers;
}

<div class="cont2">
    <div class="accounts-dashboard-details">
        <div class="accounts-length accounts">
            <p class="title" dir="ltr"><img src="icons/Asset 8mdpi.png" alt=""> The number of APKs displayed in all category</p>
            <p dir="ltr" class="accounts-nums"><span class="googleFont">@num</span>apks</p>
        </div>
    </div>
    @if (User.Role() == "Owner")
    {
        <div class="tb" style="border-radius:10px;">
            <div class="search-account">
                <div style="width: 100%;">
                    <input style="width: 100%;max-width:100%" type="text" class="search_app" dir="ltr" placeholder="Search for app">
                </div>
            </div>
            <table class="content-table t-d">
                <thead>
                    <tr>
                        <th>User Name</th>
                        <th>Current Role</th>
                        <th>New Roles</th>
                        <th>Confirm</th>
                    </tr>
                </thead>
                <tbody>
                    @{int i = 0;}
                    @foreach (var user in users)
                    {
                        <tr class="tr">
                            <td><a href="#" class="text-primary">@user.UserName</a></td>
                            <td>@user.Role()</td>
                            <td>
                                @*@Html.DropDownList("Roles", new SelectList(new string[] { "Owner", "Admin", "Member" }))*@
                                <select id="RoleComboBox@(++i)">
                                    <option value="Owner">Owner</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Member">Member</option>
                                </select>
                            </td>

                            <td>
                                <a onclick="changeRole('@user.Id', '@i');"><button class="btn btn-primary">Confirm</button></a>
                            </td>
                        </tr>
                    }

                </tbody>
            </table>
        </div>
        <div class="tb" style="border-radius:10px;">
            <table class="content-table t-d">
                <thead>
                    <tr>
                        <th>Category Name</th>
                        <th>Confirm</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="tr">
                        <td><input value="Tv" /></td>
                        <td>
                            <a><button class="btn btn-primary">Confirm</button></a>
                        </td>
                        <td><button class="btn btn-danger">Delete</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <script>
            function changeRole(userID, trID) {

                if (!confirm("Are you sure?"))
                    return;

                var roleName = document.getElementById('RoleComboBox' + trID).value;
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                        console.log(xmlHttp.responseText);
                    }
                }
                xmlHttp.open("GET", '/Dashboard/ChangeRole?UserID=' + userID + '&RoleName=' + roleName, true); // false for synchronous request
                xmlHttp.send(null);
            }
        </script>
    }

</div>

